---
layout: post
title:  Spring Surf explained
tagline: 
date:   2013-01-25 10:00:00
categories: spring-surf
excerpt: Spring Surf is a "View Composition framework" that can be used as a View in Spring MVC
---


<h1>Overview</h1>
<p>Spring Surf is a &quot;View Composition framework&quot; that can be used as a View in Spring MVC.</p>
<p>In Spring Surf each page is assembled with reusable template and multiple reusable components, called Web-Scripts. 
Template specifies page's HTML that can include components (Web-Scripts) to render parts of the page.</p>
<p>Web-Script is represented by three files:</p>
<ul>
    <li><p class="topictitle1">description xml </p></li>
    <li>free-marker template</li><li>
        <p class="topictitle1">controller script (JavaScript or java)</p></li>
</ul>
<p>Alfresco calls Web-Script &quot;mini MVC&quot; where free-marker templates are View, controller script is controller, 
    and Model is the context accessible from controller and free-marker template.
</p>

<h1>Spring Surf is not MVC framework</h1>
<p>Alfresco Quick Start is trying to position Spring Surf as MVC framework on itself, but its a far stretch cause when 
    Spring Surf page is being rendered the View is already being written to response, so its<strong> too late</strong> 
    to make any &quot;Control&quot; decisions like rendering another view or showing Error page or forwarding to another Page.</p>
<p>Here are the reasons one should not use Spring Surf as MVC framework on itself:</p>
<ul><li>Inability to separate Controller from View (its impossible to make a decision in the controller, 
        which view to display, or even forward to another controller or page)</li>
    <li>Inability to handle exceptions gracefully (when exception occurs during JavaScript execution or free-marker 
        template processing, the request is already being written, so its impossible to handle failure with dedicated error page. 
        The error message will be displayed within current, potentially, broken page)</li>
    <li>Inability to reuse controllers across multiple views (this actually relates to bullet one)</li>
    <li>Inability to apply security rules to multiple pages</li></ul>

<h1>Spring Surf is a &quot;View Composition framework&quot;</h1>
<p>While Spring Surf is not an MVC framework, it is very sophisticated and powerful &quot;View Composition framework&quot; 
    that integrates nicely with Spring MVC. Here we will try to explain how it works. </p>
<p>These are tree main types of artifacts, needed to create views:</p>
<ul>
    <li><strong>Pages</strong>
        <ul>
            <li>defined in <code>WEB-INF/pages</code></li>
            <li>consists of:
                <ul>
                    <li><strong>description .xml</strong>  - specifies Page Id, Template to use and declares page specific Components<br /><br /></li>
                </ul>
            </li>
        </ul>
    </li>
    <li><strong>Templates</strong>
        <ul>
            <li>defined in <code>WEB-INF/templates</code></li>
            <li>consists of:
                <ul>
                    <li><strong>description .xml</strong> - specifies Template Id and declares template specific Components</li>
                    <li><strong>free-marker .ftl</strong>  - specifies HTML structure of the page and uses Components to render regions of HTML</li>
                    <li><strong>controller .js</strong> (optional)<br /><br /></li>
                </ul>
            </li>
        </ul>
    </li>
    <li><strong>Web-Scripts </strong>
        <ul>
            <li>defined in <code>WEB-INF/webscripts</code></li>
            <li>consists of:
                <ul>
                    <li><strong>description .xml</strong> - specifies webscript URL - (used in component declarations)</li>
                    <li><strong>free-marker .ftl</strong> - html template</li>
                    <li><strong>controller .js</strong> (optional)</li>
                </ul>
            </li>
        </ul>
    </li>
</ul>
<div>
    <h2>Web-Scripts</h2>
    <p>Web-scripts are used to render snippets of html that can be reused across pages. Web-scripts implement presentation logic in 
        JavaScript controller, which computes values and puts them in model (similar to controller in Spring MVC). 
        That model is available in free-marker template.</p>
    <p>Web-scripts are used by Templates (see below). In order to use Web-script, it should be declared as component. 
        The Template then specifies which region of html will be rendered by which component.</p>
    <p>In typical dynamic web-application most of the content is generated by web-scripts:</p>
    <ul>
        <li>dynamic content</li>
        <li>reusable static html</li>
        <li>content from alfresco repo</li>
    </ul>
    <h3>Naming Web-Script artifacts:</h3>
    <p>Web-script artifacts should follow this naming convention:</p>
    <ul>
        <li><span style="font-size: 10.0pt;line-height: 13.0pt;">For GET requests:</span>
            <ul>
                <li><span style="font-size: 10.0pt;line-height: 13.0pt;"><strong>name.get.desc.xml</strong>  - descriptor</span></li>
                <li><strong>name.get.html.ftl</strong>     - template</li>
                <li><strong>name.get.js</strong>            - js controller</li>
            </ul>
        </li>
    </ul>
    <ul>
        <li>For POST requests:</li>
        <ul>
            <li><strong style="font-size: 10.0pt;line-height: 13.0pt;">name.post.desc.xml</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">  - descriptor</span></li>
            <li><strong style="font-size: 10.0pt;line-height: 13.0pt;">name.post.html.ftl</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">     - template</span></li>
            <li><strong style="font-size: 10.0pt;line-height: 13.0pt;">name.post.js</strong><span style="font-size: 10.0pt;line-height: 13.0pt;">            - js controller</span></li>
        </ul>
    </ul>
    <div>
*Note:*       
> If POST web-script is not provided, the GET web-script will be used by default. 
> This is very useful for rendering HTML forms. We only need to provide GET web-script for &quot;getting&quot; 
> the form and for displaying form with error when POST has failed.

    </div>
</div>
<h2>Templates</h2>
<p>In Spring-Surf we use Template to define common structure of pages. At minimum, 
    template needs <strong>description xml </strong>and <strong>free-marker ftl file</strong>. 
    Optionally, templates can have <strong>controller script</strong> if template has some logic to execute.</p>
<p>A site can have one or many templates. A template would define common HTML for all the pages using this template. 
    For example, we could have one template for Logged-out state of the application, and one template for Logged-in 
    state, with the user account Menu:</p>


![Logged out template](/assets/images/mockup_Logged out template.png)


<table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=html/xml|title=Logged out template ftl" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGl0bGU9TG9nZ2VkIG91dCB0ZW1wbGF0ZSBmdGx8bGFuZ3VhZ2U9aHRtbC94bWx9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT">
    <tr><td class="wysiwyg-macro-body">
            <pre>
&lt;html>
	&lt;body>
		&lt;@region id="Header" scope="global"/>
        &lt;div class="content">
            &lt;@region id="Content" scope="page"/>
        &lt;/div>  
        &lt;@region id="Footer" scope="global"/> 
	&lt;/body>
&lt;/html>
            </pre>
        </td>
    </tr>
</table>
<p> </p>
<p> 
    <img class="confluence-embedded-image" src="/download/attachments/17072360/mockup_Logged%20in%20template.png?version=1&amp;modificationDate=1352997933000&amp;api=v2" data-image-src="/download/attachments/17072360/mockup_Logged%20in%20template.png?version=1&amp;modificationDate=1352997933000&amp;api=v2" data-linked-resource-id="18284597" data-linked-resource-type="attachment" data-linked-resource-default-alias="mockup_Logged in template.png" data-base-url="https://confluence.valuex.com" data-linked-resource-container-id="17072360" title="Esso Extra > 1. Spring Surf explained > mockup_Logged in template.png" data-location="Esso Extra > 1. Spring Surf explained > mockup_Logged in template.png">   
</p>
<table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=html/xml|title=Logged in template ftl" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGl0bGU9TG9nZ2VkIGluIHRlbXBsYXRlIGZ0bHxsYW5ndWFnZT1odG1sL3htbH0&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT">
    <tr>
        <td class="wysiwyg-macro-body">
            <pre>
&lt;html>
	&lt;body>
		&lt;@region id="Header" scope="global"/>

        &lt;div class="content">
            &lt;@region id="Menu" scope="template"/>
            &lt;@region id="Content" scope="page"/>
        &lt;/div>  

        &lt;@region id="Footer" scope="global"/> 
	&lt;/body>
&lt;/html>
            </pre>
        </td>
    </tr>
</table>
<p> </p>
<p>The <code>@region</code> tags above are the way templates specify which component to use to render particular &quot;Region&quot; of the page. 
    The <code>id</code> and <code>scope</code> are used to locate particular component.</p>
<p>For example <code>&lt;@region id=&quot;Content&quot; scope=&quot;page&quot;/&gt;</code> 
    means we want to use &quot;Content&quot; component, declared with &quot;page&quot; scope. </p>
<p>Lets talk about components...</p>
<h2>Components</h2>
<p>Component is basically a web-script bound to an <strong>ID</strong> and <strong>Scope</strong>.</p>
<p>In order to use web-script, first it should be declared as component. 
    Below we declare component by binding <code>/contactus</code> web-script to <code>Content</code> component id.</p>
<table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=html/xml|title=Component declaration" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGl0bGU9Q29tcG9uZW50IGRlY2xhcmF0aW9ufGxhbmd1YWdlPWh0bWwveG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT">
    <tr>
        <td class="wysiwyg-macro-body">
            <pre>
&lt;components>      
	&lt;component>
		&lt;region-id>Content&lt;/region-id>            
		&lt;url>/contactus&lt;/url>
	&lt;/component>
&lt;/components>
            </pre>
        </td>
    </tr>
</table>
<table class="wysiwyg-macro" data-macro-name="note" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e25vdGV9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="RICH_TEXT">
    <tr>
        <td class="wysiwyg-macro-body">
            <p>&lt;region-id&gt; is very confusing name. This is really a component-id.</p>
        </td>
    </tr>
</table>
<h3>Component scope</h3>
<p>Component scope is implicit and derived from the location of the component declaration.</p>
<p>Components can be declared with three scopes:</p>
<ul>
    <li><strong>page</strong> - means that component is page specific (declared in current page)</li>
    <li><strong>template</strong> - means that component is template specific (declared in current template)</li>
    <li><strong>global</strong> - global component are declared separately on file system and always available. </li>
</ul>
<div>
    &quot;<strong>Page</strong>&quot; scope allows Templates (which are generic) to render page-specific content. &quot;Logged in template&quot;, 
    for example, can be used by many pages.  <code>&lt;@region id=&quot;Content&quot; scope=&quot;page&quot;/&gt;</code> 
    means that in order to render page-specific content, all pages should declare component &quot;Content&quot;. 
    If component &quot;Content&quot; is declared in Template (i.e. with &quot;template&quot; scope), it will be ignored.</div>
<div>&quot;<strong>Template</strong>&quot; scope is used to limit component only to current template. 
    Other templates can not use Component declared in this Template.</div>
<div>&quot;<strong>Global</strong>&quot; scope makes Component available globally to all templates</div>
<h3>Page component</h3><p>Page decalration consist of only one artifact - page description xml</p>
<p>Here is the example of page description xml:</p>

<table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=html/xml|title=Page description xml" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGl0bGU9UGFnZSBkZXNjcmlwdGlvbiB4bWx8bGFuZ3VhZ2U9aHRtbC94bWx9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT">
    <tr>
        <td class="wysiwyg-macro-body">
            <pre>
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;page> 
    &lt;id>contactus&lt;/id>
    &lt;description>Contact Us Page&lt;/description>   
    &lt;template-instance>logged-in-template&lt;/template-instance>
    &lt;authentication>none&lt;/authentication>
    &lt;components>    
        &lt;component>
            &lt;region-id>Content&lt;/region-id>            
            &lt;url>/contactus&lt;/url>
        &lt;/component>
    &lt;/components>
&lt;/page>
            </pre>
        </td>
    </tr>
</table>
<p>Page definition specifies:</p>
<ul>
    <li><strong>id</strong> - to be used by Spring framework to render this particular page.</li>
    <li><p><strong>template-instance</strong> - template to use to render this page</p></li>
    <li><p><strong>components</strong> - page specific components (components with page scope) </p></li>
</ul>
<h3>Template component</h3>
<p>Here we define &quot;logged-in-template&quot;, with template specific component - &quot;Menu&quot;</p>
<table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=html/xml|title=Template description xml" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGl0bGU9VGVtcGxhdGUgZGVzY3JpcHRpb24geG1sfGxhbmd1YWdlPWh0bWwveG1sfQ&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT">
    <tr>
        <td class="wysiwyg-macro-body">
            <pre>
&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;template-instance>
	&lt;title>logged-in-template&lt;/title>  
  	&lt;description>Template used by all logged-in pages&lt;/description>
   	&lt;template-type>logged-in-template&lt;/template-type>   	
 	&lt;components>
        &lt;component>
            &lt;region-id>Menu&lt;/region-id>            
            &lt;url>/user-account-menu&lt;/url>
        &lt;/component>    
    &lt;/components>   
&lt;/template-instance>
            </pre>
        </td>
    </tr>
</table>
<p> </p>
<h3>Global component</h3>
<p>Global components are defined in their own xml file, in <code>surf/site/components</code> directory 
    (should be included in web-application classpath).</p>
<p>Here we declare global &quot;footer&quot; component (see &lt;guid&gt;), that binds &quot;/footer&quot; 
    web-script (see &lt;url&gt;) to &quot;footer&quot; id (see &lt;region-id&gt;)</p>

<table class="wysiwyg-macro" data-macro-name="code" data-macro-parameters="language=html/xml|title=surf/site/components/global.footer.xml" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGU6dGl0bGU9c3VyZi9zaXRlL2NvbXBvbmVudHMvZ2xvYmFsLmZvb3Rlci54bWx8bGFuZ3VhZ2U9aHRtbC94bWx9&amp;locale=en_GB&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT">
    <tr>
        <td class="wysiwyg-macro-body">
            <pre>
&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?>
&lt;component> 
  &lt;guid>global.footer&lt;/guid>  
  &lt;component-type-id>webscript&lt;/component-type-id>  
  &lt;title>global.footer&lt;/title>  
  &lt;description>global.footer&lt;/description>  
  &lt;url>/footer&lt;/url>  
  &lt;resources/>  
  &lt;scope>global&lt;/scope>  
  &lt;source-id>global&lt;/source-id>  
  &lt;region-id>footer&lt;/region-id>  
  &lt;properties/>
&lt;/component>
            </pre>
        </td>
    </tr>
</table>

